<!doctype html>
<html>
  <head>
    <title>Container Test</title>
    <style type="text/css">
      .container {
        border: 1px solid #333;
        padding: 1em;
      }
      .section-wrapper {
        width: 98%;
        margin: auto;
      }
      .odd:last-child {
        background-color: #ebebeb;
      }

      .even:last-child {
        background-color: #ffffff;
      }
      .section {
        /*background-color: #ebebeb;*/
        width: 98%;
        margin: auto;
      }
      article {
        /*background-color: white;*/
        padding: 1em;
        box-shadow: 0 1px 0 0 rgba(0,0,0,.2);
      }
      .section--open:before {
        border-top: 3px solid red;
        display: block;
        content: '';
      }
      .section--close:after {
        display: block;
        content: '';
        border-bottom: 3px solid blue;
        margin-bottom: 1em;
      }
    </style>
  </head>
  <body ng-app="divvy">
    <header>
      <h1>Container Test</h1>
    </header>
    <main ng-controller="OpenContainerCtrl" class="container">
      <item-wrapper
        ng-repeat="i in data.entries"
        count="{{i.sectionDepth}}"
        ng-class="itemType(i.type)">
        <item ng-switch="i.type" >
          <section-body ng-switch-when="sections" resource="i.resource"></section-body>
          <resource ng-switch-when="items" resource="i.resource" class="resource"></resource>
        </item>
      </item-wrapper>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.7/angular.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-sanitize/1.5.7/angular-sanitize.min.js"></script>
    <script>
      angular.module('divvy', ['ngSanitize'])
        .controller('OpenContainerCtrl', function($scope, $sce) {
          $scope.itemType = (type) => {
            console.log(type);
            switch(type) {
              case 'sectionOpener':
                return 'section--open';
              case 'sectionCloser':
                return 'section--close';
            }
          };
          $scope.data = {
            entries: [
              {
                id: 'i1',
                type: 'items',
                resource: 'A2 further pure',
              },
              {
                id: 'i2',
                type: 'items',
                resource: 'A2 further pure'
              },
              // open 1 section
              {
                id: 'x',
                type: 'sectionOpener',
                sectionDepth: 0,
              },
              {
                id: 's1',
                type: 'sections',
                resource: 'Section 1',
                sectionDepth: 1
              },
              {
                id: 'i1.1',
                type: 'items',
                resource: 'A2 further pure',
                sectionDepth: 1
              },
              // open 1 section
              {
                type: 'sectionOpener',
                sectionDepth: 1,
              },
              {
                id: 's1.1',
                type: 'sections',
                resource: 'Section 1.1',
                sectionDepth: 2,
              },
              {
                id: 'i1.1.1',
                type: 'items',
                resource: 'A2 further pure',
                sectionDepth: 2
              },
              // open 1 section
              {
                type: 'sectionOpener',
                sectionDepth: 2,
              },
              {
                id: 's1.1.1',
                type: 'sections',
                resource: 'Section 1.1.1',
                sectionDepth: 3,
              },
              {
                id: 'i1.1.1.1',
                type: 'items',
                resource: 'A2 further pure',
                sectionDepth: 3
              },
              {
                id: 'i1.1.1.2',
                type: 'items',
                resource: 'A2 further pure',
                sectionDepth: 3,
              },
              // close 3 sections
              {
                type: 'sectionCloser',
                sectionDepth: 2,
              },
              {
                type: 'sectionCloser',
                sectionDepth: 1,
              },
              {
                type: 'sectionCloser',
                sectionDepth: 0,
              },
              // open 1 section
              {
                type: 'sectionOpener',
                sectionDepth: 0,
              },
              {
                id: 's2',
                type: 'sections',
                resource: 'Section 2',
                sectionDepth: 1
              },
              {
                id: 'i2.1',
                type: 'items',
                resource: 'A2 further pure',
                sectionDepth: 1,
              },
              {
                id: 'i2.2',
                type: 'items',
                resource: 'A2 further pure',
                sectionDepth: 1,
              },
              {
                id: 'i2.3',
                type: 'items',
                resource: 'A2 further pure',
                sectionDepth: 1,
              },
              {
                id: 'i2.4',
                type: 'items',
                resource: 'A2 further pure',
                sectionDepth: 1,
              },
              // open section 2.1
              {
                type: 'sectionOpener',
                sectionDepth: 1
              },
              {
                id: 's2.1',
                type: 'sections',
                resource: 'Section 2.1',
                sectionDepth: 2
              },
              {
                id: 'i2.1.1',
                type: 'items',
                resource: 'A2 further pure',
                sectionDepth: 2,
              },
              {
                id: 'i2.1.2',
                type: 'items',
                resource: 'A2 further pure',
                sectionDepth: 2,
              },
              // close section 2.1
              {
                type: 'sectionCloser',
                sectionDepth: 1
              },
              // open section 2.2
              {
                type: 'sectionOpener',
                sectionDepth: 1
              },
              {
                id: 's2.2',
                type: 'sections',
                resource: 'Section 2.2',
                sectionDepth: 1
              },
              {
                id: 'i2.2.1',
                type: 'items',
                resource: 'A2 further pure',
                sectionDepth: 2,
              },
              {
                id: 'i2.2.2',
                type: 'items',
                resource: 'A2 further pure',
                sectionDepth: 2,
              },
              // close section 2.2
              {
                type: 'sectionCloser',
                sectionDepth: 1,
              },
              {
                type: 'sectionCloser',
                sectionDepth: 0,
              }
            ]
            };
        })
        .directive('itemWrapper', function() {
          return {
            restrict: 'E',
            scope: {
              type: '@',
              count: '@',
              resource: '@'
            },
            link: function(scope, element, attrs) {
              const oddOrEven = scope.count % 2 === 0 ? "odd" : "even";
              while (scope.count > 0) {
                element.wrap(`<div class="section-wrapper ${oddOrEven}"></div>`);
                scope.count--;
              }
            }
          };
        })
        .component('sectionBody', {
          bindings: {
            resource: '<'
          },
          template: '<section class="section"><h2>{{$ctrl.resource}}</h2></div>'
        })
        .component('resource', {
          bindings: {
            resource: '<'
          },
          template: `<article><img src="http://placehold.it/50x50/" alt="" />{{$ctrl.resource}}</article>`
        });
    </script>
  </body>
</html>
